<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Horoscope PRO - Cool Edition</title>
<style>
:root{
  --bg:#0e1116; --ink:#e5e7eb; --muted:#a8b0bc; --ring:#1e2530;
  --card:#121722; --accent:#3aa0ff; --accent2:#ff65cf;
  --dial:#0b0f18; --band:#0b2240; --outer:#2a3442;
  --sq:#ff5a68; --tr:#6aa8ff; --se:#35cf95; --op:#f5b04c; --cj:#ffffff; --inc:#b48bff;
  --grid:#263141; --axis:#354358; --mate:#ff65cf;
}
*{box-sizing:border-box}
body{
  margin:0;color:var(--ink);
  background:
    radial-gradient(900px 600px at 20% -10%, rgba(58,160,255,.10), transparent 60%),
    radial-gradient(1100px 700px at 80% -20%, rgba(255,101,207,.10), transparent 60%),
    radial-gradient(1400px 900px at 50% 120%, rgba(0,0,0,.5), rgba(14,17,22,1) 60%),
    repeating-conic-gradient(from 0deg, rgba(255,255,255,.025) 0deg 10deg, rgba(255,255,255,0) 10deg 20deg),
    #0e1116;
  font-family: "Times New Roman","Palatino Linotype",Georgia, ui-serif, system-ui, -apple-system, "Yu Mincho","Hiragino Mincho ProN", serif;
}
header{position:sticky;top:0;background:linear-gradient(180deg,rgba(14,17,22,.9),rgba(14,17,22,.6));backdrop-filter:blur(8px);border-bottom:1px solid var(--ring);z-index:10}
.wrap{max-width:1280px;margin:0 auto;padding:14px}
h1{font-size:20px;margin:0} .sub{font-size:12px;color:var(--muted)}
.tabs{display:flex;gap:.5rem;margin-top:.5rem}
.tab{padding:.45rem .8rem;border:1px solid var(--ring);border-radius:999px;background:#0f1420;font-size:13px;cursor:pointer;color:#cbd5e1}
.tab.active{background:var(--accent);color:#0b1220;border-color:var(--accent);box-shadow:0 0 0 4px rgba(58,160,255,.18)}
.grid{display:grid;gap:12px}
@media(min-width:1150px){.grid{grid-template-columns:430px 1fr}}
.card{background:linear-gradient(180deg,#0f1420,#0d121b);border:1px solid var(--ring);border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
label{font-size:12px;color:var(--muted)}
input,select,button,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--ring);background:#0c121c;color:#e5e7eb}
input::placeholder{color:#6b7280}
.btn{cursor:pointer;background:#111827;border:1px solid var(--ring)} .btn:hover{background:#0f172a}
.btn-ac{background:var(--accent);color:#0b1220;border-color:var(--accent)}
.small{font-size:12px;color:var(--muted)}
hr.sep{border:0;border-top:1px solid var(--ring);margin:12px 0}
canvas{width:100%;height:auto;background:var(--dial);border-radius:12px;border:1px solid var(--ring)}
.table{width:100%;border-collapse:collapse;font-size:12px}
.table th,.table td{border-bottom:1px solid var(--ring);padding:6px 6px;text-align:left}
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.legend span{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--ring);padding:3px 8px;border-radius:999px;font-size:12px;background:#0f1420}
.color{width:10px;height:10px;border-radius:50%}
.block{background:linear-gradient(180deg,#0f1420,#0c121c);border:1px solid var(--ring);border-radius:12px;padding:12px;margin-top:10px}
.block h4{margin:0 0 8px}
.badge{display:inline-block;border:1px solid var(--ring);border-radius:999px;padding:2px 8px;font-size:11px;color:var(--muted)}
.summary{background:#0f1420;border:1px solid var(--ring);border-radius:12px;padding:10px 14px;margin-top:10px}
.summary .row3{display:grid;grid-template-columns:120px 1fr;gap:8px;font-size:14px}
.ribbon{display:inline-block;background:#0e274b;color:#fff;padding:6px 14px;border-radius:8px;font-weight:700;letter-spacing:.05em}
.panel{background:#0f1420;border:1px solid var(--ring);border-radius:12px;padding:12px}
.panel .cols{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.pillrow{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}
.pill{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--ring);border-radius:999px;padding:3px 9px;background:#0c121c}
.sectionGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.box{border:1px solid var(--ring);border-radius:10px;padding:8px 10px;background:#0f1420}
.box h5{margin:0 0 6px;font-size:13px}
.box ul{margin:0;padding-left:16px;font-size:12px;line-height:1.6}
.matrix{border-collapse:collapse;width:100%;font-size:12px}
.matrix th,.matrix td{border:1px solid var(--ring);padding:4px;text-align:center}
.matrix th{background:#0f1420;position:sticky;top:0}
.note{font-size:11px;color:var(--muted)}
.hide{display:none}
textarea{min-height:180px}
footer{color:#6b7280;font-size:12px;text-align:center;padding:18px 0}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Horoscope PRO <span class="badge">Cool Edition</span></h1>
    <div class="sub">ãƒ€ãƒ¼ã‚¯ï½œå¹¾ä½•å­¦èƒŒæ™¯ï½œã‚¯ãƒ©ã‚·ã‚«ãƒ«è¨˜å·ï½œè§’åº¦ãƒ©ãƒ™ãƒ«ä»˜ãã‚¢ã‚¹ãƒšã‚¯ãƒˆï½œæ ¼å­ãƒãƒˆãƒªã‚¯ã‚¹ï½œç›¸æ€§ï½œã‚„ã•ã—ã‚AIé‘‘å®šï¼ˆãƒšãƒ¼ã‚¸å†…ï¼‰</div>
    <div class="tabs">
      <button class="tab active" data-tab="natal">ãƒã‚¤ã‚¿ãƒ«</button>
      <button class="tab" data-tab="syn">ç›¸æ€§ï¼ˆã‚·ãƒŠã‚¹ãƒˆãƒªãƒ¼ï¼‰</button>
    </div>
  </div>
</header>

<!-- NATAL -->
<main id="natal" class="wrap grid">
  <section class="card">
    <h3 style="margin-top:0">å…¥åŠ›ï¼ˆãƒã‚¤ã‚¿ãƒ«ï¼‰</h3>
    <div class="row">
      <div><label>æ°å</label><input id="name" placeholder="ä¾‹ï¼šé‘‘å®šAã•ã‚“"></div>
      <div><label>ç”Ÿå¹´æœˆæ—¥</label><input id="date" type="date"></div>
    </div>
    <div class="row">
      <div><label>å‡ºç”Ÿæ™‚åˆ»</label><input id="time" type="time" step="60"></div>
      <div><label>å‡ºç”Ÿåœ°ï¼ˆåœ°åâ†’ç·¯åº¦çµŒåº¦ï¼‰</label>
        <div class="row" style="grid-template-columns:1fr auto">
          <input id="place" placeholder="ä¾‹ï¼šæ„›çŸ¥çœŒ åå¤å±‹å¸‚"><button class="btn" id="geo">æ¤œç´¢</button>
        </div>
      </div>
    </div>
    <div class="row">
      <div><label>ç·¯åº¦</label><input id="lat" type="number" step="0.0001"></div>
      <div><label>çµŒåº¦</label><input id="lon" type="number" step="0.0001"></div>
    </div>
    <div class="row">
      <div><label>UTCï¼ˆæ—¥æœ¬=9ï¼‰</label><input id="tz" type="number" step="0.25" value="9"></div>
      <div><label>DST</label><select id="dst"><option value="0">ãªã—</option><option value="1">+1h</option></select></div>
    </div>
    <div class="row">
      <div><label>ãƒã‚¦ã‚¹</label><select id="house"><option value="whole">Whole Sign</option><option value="equal">Equal</option></select></div>
      <div><label>ã‚¢ã‚¹ãƒšã‚¯ãƒˆOrbï¼ˆåº¦ï¼‰</label><input id="orb" type="number" value="6" step="0.5"></div>
    </div>
    <div class="row">
      <div><label>ã‚µã‚¤ã‚º</label><select id="size"><option value="1">æ¨™æº–</option><option value="1.2">å¤§ãã‚</option><option value="1.4">ç‰¹å¤§</option></select></div>
      <div class="legend">
        <span><i class="color" style="background:var(--cj)"></i>â˜Œ Conj</span>
        <span><i class="color" style="background:var(--se)"></i>âš¹ Sext</span>
        <span><i class="color" style="background:var(--sq)"></i>â–¡ Square</span>
        <span><i class="color" style="background:var(--tr)"></i>â–³ Trine</span>
        <span><i class="color" style="background:var(--inc)"></i>âš» Quincunx</span>
        <span><i class="color" style="background:var(--op)"></i>â˜ Opp</span>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="calcAsc">Asc/MC è¨ˆç®—</button>
      <button class="btn btn-ac" id="run">é‘‘å®šã‚’ä½œæˆ</button>
    </div>
    <div class="small">â€»å¤©ä½“ã¯ç°¡æ˜“è¿‘ä¼¼ï¼ˆÂ±1ã€œ2Â°ç›®å®‰ï¼‰ã€‚å³å¯†åº¦æ•°ã¯Swiss Ephemeriså·®ã—æ›¿ãˆå¯ã€‚</div>
  </section>

  <section class="card">
    <h3 style="margin-top:0">ãƒãƒ£ãƒ¼ãƒˆ</h3>
    <canvas id="cv" width="1240" height="1240"></canvas>

    <div id="summaryCard" class="summary">
      <div class="row3"><div>NAME</div><div id="sum_name">â€”</div></div>
      <div class="row3"><div>DATE</div><div id="sum_date">â€”</div></div>
      <div class="row3"><div>PLACE</div><div id="sum_place">â€”</div></div>
    </div>

    <div class="panel" style="margin-top:14px">
      <div class="ribbon">3åŒºåˆ†</div>
      <div class="cols" style="margin-top:8px">
        <div><div class="small">æ´»å‹•</div><div id="mod_act" class="pillrow"></div></div>
        <div><div class="small">ä¸å‹•</div><div id="mod_fix" class="pillrow"></div></div>
        <div><div class="small">æŸ”è»Ÿ</div><div id="mod_mut" class="pillrow"></div></div>
      </div>
    </div>

    <div class="panel" style="margin-top:10px">
      <div class="ribbon">4åŒºåˆ†</div>
      <div class="cols" style="margin-top:8px">
        <div><div class="small">ç«</div><div id="elm_fire" class="pillrow"></div></div>
        <div><div class="small">åœ°</div><div id="elm_earth" class="pillrow"></div></div>
        <div><div class="small">é¢¨</div><div id="elm_air" class="pillrow"></div></div>
        <div><div class="small">æ°´</div><div id="elm_water" class="pillrow"></div></div>
      </div>
    </div>

    <div class="block">
      <h4>ã‚¢ã‚¹ãƒšã‚¯ãƒˆï¼ˆæ ¼å­ãƒãƒˆãƒªã‚¯ã‚¹ï¼‰</h4>
      <table class="matrix" id="aspMatrix"></table>
      <div class="note">â˜Œ Conjï¼âš¹ Sextï¼â–¡ Squareï¼â–³ Trineï¼âš» Quincunxï¼â˜ Oppï¼ˆä¸­å¤®ã«ã€Œâ–¡ 90Â°ã€ãªã©è§’åº¦è¡¨ç¤ºï¼orbã‚‚ç®—å‡ºï¼‰</div>
    </div>

    <div class="sectionGrid" style="margin-top:10px">
      <div class="box"><h5>â˜Œ ã‚³ãƒ³ã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³(0Â°)</h5><ul id="list_conj"></ul></div>
      <div class="box"><h5>âš¹ ã‚»ã‚¯ã‚¹ã‚¿ã‚¤ãƒ«(60Â°)</h5><ul id="list_sext"></ul></div>
      <div class="box"><h5>â–¡ ã‚¹ã‚¯ã‚¨ã‚¢(90Â°)</h5><ul id="list_sq"></ul></div>
      <div class="box"><h5>â–³ ãƒˆãƒ©ã‚¤ãƒ³(120Â°)</h5><ul id="list_tr"></ul></div>
      <div class="box"><h5>âš» ã‚¯ã‚¤ãƒ³ã‚«ãƒ³ã‚¯ã‚¹(150Â°)</h5><ul id="list_inc"></ul></div>
      <div class="box"><h5>â˜ ã‚ªãƒã‚¸ã‚·ãƒ§ãƒ³(180Â°)</h5><ul id="list_opp"></ul></div>
    </div>

    <div class="block">
      <h4>AIè‡ªå‹•é‘‘å®šï¼ˆã‚„ã•ã—ã‚ï¼‰</h4>
      <textarea id="report" placeholder="é‘‘å®šçµæœãŒã“ã“ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™â€¦"></textarea>
    </div>
  </section>
</main>

<!-- SYN -->
<main id="syn" class="wrap grid hide">
  <section class="card">
    <h3 style="margin-top:0">å…¥åŠ›ï¼ˆç›¸æ€§ï¼‰</h3>
    <div class="row">
      <div><label>A ç”Ÿå¹´æœˆæ—¥</label><input id="A_date" type="date"></div>
      <div><label>A æ™‚åˆ»</label><input id="A_time" type="time" step="60"></div>
    </div>
    <div class="row">
      <div><label>A åœ°å</label>
        <div class="row" style="grid-template-columns:1fr auto">
          <input id="A_place"><button class="btn" id="A_geo">æ¤œç´¢</button>
        </div>
      </div>
      <div class="small">A ç·¯åº¦/çµŒåº¦ <input id="A_lat" type="number" step="0.0001" style="width:6.5em"> / <input id="A_lon" type="number" step="0.0001" style="width:6.5em"></div>
    </div>
    <hr class="sep">
    <div class="row">
      <div><label>B ç”Ÿå¹´æœˆæ—¥</label><input id="B_date" type="date"></div>
      <div><label>B æ™‚åˆ»</label><input id="B_time" type="time" step="60"></div>
    </div>
    <div class="row">
      <div><label>B åœ°å</label>
        <div class="row" style="grid-template-columns:1fr auto">
          <input id="B_place"><button class="btn" id="B_geo">æ¤œç´¢</button>
        </div>
      </div>
      <div class="small">B ç·¯åº¦/çµŒåº¦ <input id="B_lat" type="number" step="0.0001" style="width:6.5em"> / <input id="B_lon" type="number" step="0.0001" style="width:6.5em"></div>
    </div>
    <div class="row">
      <div><label>UTCï¼ˆæ—¥æœ¬=9ï¼‰</label><input id="syn_tz" type="number" value="9" step="0.25"></div>
      <div><label>DST</label><select id="syn_dst"><option value="0">ãªã—</option><option value="1">+1h</option></select></div>
    </div>
    <div class="row">
      <div><label>ãƒã‚¦ã‚¹</label><select id="syn_house"><option value="whole">Whole</option><option value="equal">Equal</option></select></div>
      <div><label>Orb</label><input id="syn_orb" type="number" value="6" step="0.5"></div>
    </div>
    <button class="btn btn-ac" id="syn_run" style="margin-top:8px">ç›¸æ€§ã‚’ä½œæˆ</button>
  </section>

  <section class="card">
    <h3 style="margin-top:0">åˆæˆãƒãƒ£ãƒ¼ãƒˆï¼ˆA=æ¿ƒç´º / B=ãƒã‚¼ãƒ³ã‚¿ï¼‰</h3>
    <canvas id="cv_syn" width="1240" height="1240"></canvas>

    <div class="block">
      <h4>ç›¸æ€§ã‚¢ã‚¹ãƒšã‚¯ãƒˆï¼ˆæ ¼å­ãƒãƒˆãƒªã‚¯ã‚¹ï¼‰</h4>
      <table class="matrix" id="synMatrix"></table>
    </div>

    <div class="block">
      <h4>ç›¸æ€§AIã‚³ãƒ¡ãƒ³ãƒˆï¼ˆã‚„ã•ã—ã‚ï¼‰</h4>
      <textarea id="synReport" placeholder="ç›¸æ€§ã®è§£èª¬ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™â€¦"></textarea>
    </div>
  </section>
</main>

<footer class="wrap">Â© Horoscope PRO - Cool Editionï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«å®Ÿè£…ï¼‰</footer>

<script>
// ===== Unicode glyphs (æ­£å¼è¨˜å·)
const ZGLYPH = ["â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™","â™","â™‘","â™’","â™“"];
const PLANETS = [
  ["Sun","å¤ªé™½","â˜‰"],["Moon","æœˆ","â˜½"],["Mercury","æ°´æ˜Ÿ","â˜¿"],["Venus","é‡‘æ˜Ÿ","â™€"],
  ["Mars","ç«æ˜Ÿ","â™‚"],["Jupiter","æœ¨æ˜Ÿ","â™ƒ"],["Saturn","åœŸæ˜Ÿ","â™„"],
  ["Uranus","å¤©ç‹æ˜Ÿ","â™…"],["Neptune","æµ·ç‹æ˜Ÿ","â™†"],["Pluto","å†¥ç‹æ˜Ÿ","â™‡"],
  ["ASC","ASC","ASC"],["MC","MC","MC"]
];
// â˜Œ Conj, âš¹ Sext, â–¡ Square, â–³ Trine, âš» Quincunx, â˜ Opposition
const ASP = [
  ["Conj",0,8,"var(--cj)","â˜Œ","0Â°"],
  ["Sext",60,5,"var(--se)","âš¹","60Â°"],
  ["Square",90,6,"var(--sq)","â–¡","90Â°"],
  ["Trine",120,7,"var(--tr)","â–³","120Â°"],
  ["Inc",150,4.5,"var(--inc)","âš»","150Â°"],
  ["Opp",180,8,"var(--op)","â˜","180Â°"]
];

const DEG=Math.PI/180; const SIGNS=["ç‰¡ç¾Š","ç‰¡ç‰›","åŒå­","èŸ¹","ç…å­","ä¹™å¥³","å¤©ç§¤","è ","å°„æ‰‹","å±±ç¾Š","æ°´ç“¶","é­š"];
const JP = {Sun:"å¤ªé™½", Moon:"æœˆ", Mercury:"æ°´æ˜Ÿ", Venus:"é‡‘æ˜Ÿ", Mars:"ç«æ˜Ÿ", Jupiter:"æœ¨æ˜Ÿ", Saturn:"åœŸæ˜Ÿ", Uranus:"å¤©ç‹æ˜Ÿ", Neptune:"æµ·ç‹æ˜Ÿ", Pluto:"å†¥ç‹æ˜Ÿ"};
const GL = Object.fromEntries(PLANETS.map(p=>[p[0],p[2]]));

// --- math / time
function mod360(x){x%=360;if(x<0)x+=360;return x}
function dAng(a,b){let d=Math.abs(a-b)%360; if(d>180)d=360-d; return d}
function jdFromYMD(y,m,dd,hh=0,mi=0){if(m<=2){y-=1;m+=12}const A=Math.floor(y/100),B=2-A+Math.floor(A/4),day=dd+(hh+mi/60)/24;return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+day+B-1524.5;}
function gstDeg(jd){const T=(jd-2451545.0)/36525;return mod360(280.46061837+360.98564736629*(jd-2451545.0)+0.000387933*T*T-(T*T*T)/38710000)}
function obliqDeg(jd){const T=(jd-2451545.0)/36525;return 23+26/60+21.448/3600-(46.8150*T+0.00059*T*T-0.001813*T*T*T)/3600}
function ascMcFrom(jd,latDeg,lonDeg){
  const eps=obliqDeg(jd)*DEG,g=gstDeg(jd)*DEG,lst=g+lonDeg*DEG,phi=latDeg*DEG;
  let Lmc=Math.atan2(Math.sin(lst)*Math.cos(eps),Math.cos(lst)); Lmc=mod360(Lmc/DEG);
  const sinE=Math.sin(eps),cosE=Math.cos(eps),tanPhi=Math.tan(phi),sinL=Math.sin(lst),cosL=Math.cos(lst);
  let Lasc=Math.atan2(-cosL, sinL*cosE - tanPhi*sinE); Lasc=mod360(Lasc/DEG);
  return {ASC:Lasc,MC:Lmc};
}

// --- geocode
function geocode(q){return fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`,{headers:{'Accept-Language':'ja'}}).then(r=>r.json()).then(js=>js?.[0]?{lat:+js[0].lat,lon:+js[0].lon}:null).catch(_=>null)}
function degToSignText(d){d=mod360(d); const s=Math.floor(d/30),a=d-s*30; return `${SIGNS[s]} ${a.toFixed(2)}Â°`;}

// --- ephemeris (ç°¡æ˜“)
function Tcent(jd){return (jd-2451545.0)/36525}
function sunLon(jd){const T=Tcent(jd); const L0=mod360(280.46646+36000.76983*T+0.0003032*T*T); const M=mod360(357.52911+35999.05029*T-0.0001537*T*T)*DEG; const C=(1.914602-0.004817*T-0.000014*T*T)*Math.sin(M)+(0.019993-0.000101*T)*Math.sin(2*M)+0.000289*Math.sin(3*M); return mod360(L0+C);}
function moonLon(jd){const T=Tcent(jd), L0=mod360(218.3164477+481267.88123421*(jd-2451545)/36525); const M=mod360(134.9633964+477198.8675055*(jd-2451545)/36525)*DEG; const D=mod360(297.8501921+445267.1114034*(jd-2451545)/36525)*DEG; let lon=L0 + 6.289*Math.sin(M) + 1.274*Math.sin(2*D - M) + 0.658*Math.sin(2*D) + 0.214*Math.sin(2*M) + 0.11*Math.sin(D); return mod360(lon);}
function planetMean(name){const n={Mercury:4.09233445, Venus:1.60213034, Mars:0.524039, Jupiter:0.0830867, Saturn:0.03344414, Uranus:0.0117696, Neptune:0.0060201, Pluto:0.0039640};
  const L0={Mercury:252.2509,Venus:181.9798,Mars:355.4330,Jupiter:34.3515,Saturn:50.0774,Uranus:314.0550,Neptune:304.3487,Pluto:238.9290};
  return jd=>mod360(L0[name]+n[name]*(jd-2451545.0));
}
const LON={Sun:jd=>sunLon(jd), Moon:jd=>moonLon(jd),
  Mercury:planetMean("Mercury"),Venus:planetMean("Venus"),Mars:planetMean("Mars"),
  Jupiter:planetMean("Jupiter"),Saturn:planetMean("Saturn"),
  Uranus:planetMean("Uranus"),Neptune:planetMean("Neptune"),Pluto:planetMean("Pluto")};

// --- houses
const Houses={whole(asc){const s=Math.floor(asc/30);return[...Array(12)].map((_,i)=>mod360((s+i)*30))}, equal(asc){return[...Array(12)].map((_,i)=>mod360(asc+i*30))}};

// --- aspects
function findAspects(pos,orb){const keys=Object.keys(pos).filter(k=>!["ASC","MC"].includes(k)); const out=[]; for(let i=0;i<keys.length;i++){for(let j=i+1;j<keys.length;j++){const A=pos[keys[i]],B=pos[keys[j]], delta=dAng(A,B); ASP.forEach(s=>{if(Math.abs(delta-s[1])<= (orb??s[2])) out.push({p1:keys[i],p2:keys[j],type:s[0],deg:s[1],delta:(delta-s[1])});});}} return out;}
function aspectColor(t){return t==="Square"?"--sq":t==="Trine"?"--tr":t==="Sext"?"--se":t==="Opp"?"--op":t==="Inc"?"--inc":"--cj"}
function aspectLabel(t){const a=ASP.find(x=>x[0]===t); return `${a[4]} ${a[5]}`}

// --- draw
function drawChart(canvas,pos,houses,opt={}){
  const ctx=canvas.getContext('2d'), W=canvas.width, H=canvas.height, cx=W/2, cy=H/2;
  const scale=parseFloat(document.getElementById('size')?.value||"1");
  ctx.clearRect(0,0,W,H); const R=Math.min(W,H)*0.46;

  // outer ring
  ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.strokeStyle=getCSS('--outer'); ctx.lineWidth=22; ctx.stroke();

  // zodiac band
  const bandR1=R-18, bandR2=R-92;
  for(let i=0;i<12;i++){
    const a0=(i*30)*DEG - Math.PI/2, a1=a0+30*DEG;
    ctx.beginPath(); ctx.moveTo(cx+bandR2*Math.cos(a0),cy+bandR2*Math.sin(a0));
    ctx.arc(cx,cy,bandR1,a0,a1); ctx.lineTo(cx+bandR2*Math.cos(a1),cy+bandR2*Math.sin(a1));
    ctx.arc(cx,cy,bandR2,a1,a0,true); ctx.closePath();
    ctx.fillStyle=getCSS('--band'); ctx.fill();
    // sign glyph
    const mid=a0+15*DEG, rx=cx+(bandR1+bandR2)/2*Math.cos(mid), ry=cy+(bandR1+bandR2)/2*Math.sin(mid);
    ctx.fillStyle="#ffffff";
    ctx.font=`bold ${Math.round(24*scale)}px 'Times New Roman','Noto Sans Symbols2',serif`;
    ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(ZGLYPH[i],rx,ry);
  }

  // house lines + labels
  if(houses){ for(let i=0;i<12;i++){ const ang=houses[i]*DEG - Math.PI/2;
    const x=cx+bandR2*Math.cos(ang), y=cy+bandR2*Math.sin(ang);
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x,y); ctx.strokeStyle=i===0?getCSS('--accent'):'#334155'; ctx.lineWidth=i===0?3:1; ctx.stroke();
    const tx=cx+(bandR2-24)*Math.cos(ang), ty=cy+(bandR2-24)*Math.sin(ang);
    ctx.fillStyle=i===0?getCSS('--accent'):'#94a3b8';
    ctx.font=`bold ${Math.round(12*scale)}px 'Times New Roman',serif`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText((i+1),tx,ty);
  } }

  // aspect inner circle
  const innerR=bandR2-120; ctx.beginPath(); ctx.arc(cx,cy,innerR,0,Math.PI*2); ctx.strokeStyle="#334155"; ctx.lineWidth=1; ctx.stroke();

  // planet nodes pos
  const nodes={}, rPl=bandR2-26;
  Object.keys(pos).forEach(k=>{const ang=pos[k]*DEG - Math.PI/2; nodes[k]={ang,x:cx+rPl*Math.cos(ang),y:cy+rPl*Math.sin(ang)};});
  const keys=Object.keys(pos).filter(k=>!["ASC","MC"].includes(k));

  // collision resolve
  for(let iter=0;iter<80;iter++){
    for(let a=0;a<keys.length;a++){for(let b=a+1;b<keys.length;b++){
      const A=nodes[keys[a]],B=nodes[keys[b]]; const dx=B.x-A.x, dy=B.y-A.y, d=Math.hypot(dx,dy);
      if(d<28){const ux=dx/d||0, uy=dy/d||0; A.x+=-ux;A.y+=-uy; B.x+=ux;B.y+=uy;}
    }}
  }

  // aspects
  const aspects=findAspects(pos,opt.orb);
  aspects.forEach(a=>{
    const p1=nodes[a.p1], p2=nodes[a.p2]; if(!p1||!p2)return;
    const x1=cx+innerR*Math.cos(p1.ang), y1=cy+innerR*Math.sin(p1.ang);
    const x2=cx+innerR*Math.cos(p2.ang), y2=cy+innerR*Math.sin(p2.ang);
    const col=getCSS(aspectColor(a.type)); ctx.strokeStyle=col; ctx.lineWidth=a.type==="Conj"?3.2:2.6; ctx.globalAlpha=0.96;
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke(); ctx.globalAlpha=1;
    const mx=(x1+x2)/2, my=(y1+y2)/2; ctx.fillStyle=col;
    ctx.font=`bold ${Math.round(12*scale)}px 'Times New Roman','Noto Sans Symbols2',ui-monospace`;
    ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(aspectLabel(a.type),mx,my);
  });

  // planets
  keys.forEach(k=>{
    const p=nodes[k];
    ctx.beginPath(); ctx.arc(p.x,p.y,13*scale,0,Math.PI*2); ctx.fillStyle="#0b1423"; ctx.fill();
    ctx.lineWidth=2.2; ctx.strokeStyle="#9fb3c8"; ctx.stroke();
    const gl=PLANETS.find(x=>x[0]===k)[2];
    ctx.fillStyle="#dbe7f2";
    ctx.font=`bold ${Math.round(16*scale)}px 'Times New Roman','Noto Sans Symbols2',serif`;
    ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(gl,p.x,p.y);
  });

  // ASC/MC labels
  ["ASC","MC"].forEach(key=>{
    const ang=pos[key]*DEG - Math.PI/2; const rx=cx+(R-6)*Math.cos(ang), ry=cy+(R-6)*Math.sin(ang);
    ctx.fillStyle= key==="ASC" ? getCSS('--accent') : getCSS('--accent2');
    ctx.font=`bold ${Math.round(16*scale)}px 'Times New Roman',serif`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(key,rx,ry);
  });

  function getCSS(v){return getComputedStyle(document.body).getPropertyValue(v).trim()}
}

// --- helpers (elements/modality)
function elementOf(deg){const s=Math.floor(mod360(deg)/30); return [0,4,8].includes(s)?"ç«":[1,5,9].includes(s)?"åœ°":[2,6,10].includes(s)?"é¢¨":"æ°´"}
function modalityOf(deg){const s=Math.floor(mod360(deg)/30); return [0,3,6,9].includes(s)?"æ´»å‹•":[1,4,7,10].includes(s)?"ä¸å‹•":"æŸ”è»Ÿ"}
function setBarsAndPills(pos){
  const planets=["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"];
  const m={æ´»å‹•:[],ä¸å‹•:[],æŸ”è»Ÿ:[]}, e={ç«:[],åœ°:[],é¢¨:[],æ°´:[]};
  planets.forEach(k=>{ const d=pos[k]; m[modalityOf(d)].push(k); e[elementOf(d)].push(k); });
  const set=(id,arr)=>{document.getElementById(id).innerHTML = arr.map(k=>`<span class="pill">${GL[k]} ${JP[k]}</span>`).join("") || "<span class='small'>â€”</span>"};
  set("mod_act", m.æ´»å‹•); set("mod_fix", m.ä¸å‹•); set("mod_mut", m.æŸ”è»Ÿ);
  set("elm_fire", e.ç«); set("elm_earth", e.åœ°); set("elm_air", e.é¢¨); set("elm_water", e.æ°´);
}

// --- matrices
const DISP_KEYS=["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"];
function buildMatrix(table,pos,orb){
  const head=DISP_KEYS.map(k=>GL[k]);
  let html=`<tr><th></th>${head.map(h=>`<th>${h}</th>`).join("")}</tr>`;
  for(let i=0;i<DISP_KEYS.length;i++){
    const ki=DISP_KEYS[i]; html+=`<tr><th>${head[i]}</th>`;
    for(let j=0;j<DISP_KEYS.length;j++){
      if(j<=i){ html+=`<td style="background:#0f1420"></td>`; continue;}
      const a=findAspects({[ki]:pos[ki],[DISP_KEYS[j]]:pos[DISP_KEYS[j]]},orb)[0];
      html+=`<td>${a?ASP.find(s=>s[0]===a.type)[4]:""}</td>`;
    }
    html+=`</tr>`;
  }
  table.innerHTML=html;
}
function buildSynMatrix(table,posA,posB,orb){
  const head=DISP_KEYS.map(k=>GL[k]);
  let html=`<tr><th>A\\B</th>${head.map(h=>`<th>${h}</th>`).join("")}</tr>`;
  for(let i=0;i<DISP_KEYS.length;i++){
    const ki=DISP_KEYS[i]; html+=`<tr><th>${head[i]}</th>`;
    for(let j=0;j<DISP_KEYS.length;j++){
      const a=findAspects({[ki]:posA[ki],[DISP_KEYS[j]]:posB[DISP_KEYS[j]]},orb,true)[0];
      html+=`<td>${a?ASP.find(s=>s[0]===a.type)[4]:""}</td>`;
    }
    html+=`</tr>`;
  }
  table.innerHTML=html;
}

// --- aspect list
function orbText(deltaDeg){const a=Math.abs(deltaDeg); const d=Math.floor(a); const m=Math.round((a-d)*60); return `orb ${d}Â° ${m.toString().padStart(2,"0")}'`;}
function buildAspectLists(pos, orb){
  const asp = findAspects(pos, orb, true);
  const buckets = {Conj:[], Sext:[], Square:[], Trine:[], Inc:[], Opp:[]};
  asp.forEach(a=>{
    const label = `${GL[a.p1]||JP[a.p1]||a.p1} Ã— ${GL[a.p2]||JP[a.p2]||a.p2}ã€€(${orbText(a.delta)})`;
    buckets[a.type]?.push(label);
  });
  const put = (id, arr)=> document.getElementById(id).innerHTML =
    (arr.length? arr.map(x=>`<li>${x}</li>`).join("") : "<li>ãªã—</li>");
  put("list_conj", buckets.Conj); put("list_sext", buckets.Sext); put("list_sq", buckets.Square);
  put("list_tr", buckets.Trine);  put("list_inc", buckets.Inc);   put("list_opp", buckets.Opp);
}

// --- AI gentle reading
function gentlePara(t){return `â€¢ ${t}`;}
function aiReading(meta,pos,houses){
  const sun=pos.Sun, moon=pos.Moon, asc=pos.ASC, mc=pos.MC;
  const sunS=Math.floor(sun/30), moonS=Math.floor(moon/30);
  const elCount={ç«:0,åœ°:0,é¢¨:0,æ°´:0}; const mdCount={æ´»å‹•:0,ä¸å‹•:0,æŸ”è»Ÿ:0};
  ["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn"].forEach(k=>{elCount[elementOf(pos[k])]++; mdCount[modalityOf(pos[k])]++;});
  function pickEnergy(){const sorted=Object.entries(elCount).sort((a,b)=>b[1]-a[1]); const top=sorted[0][0], second=sorted[1][0];
    const map={ç«:"è¡Œå‹•ãŒæ—©ã„/æƒ…ç†±ãŒç‡ƒãˆã‚„ã™ã„",åœ°:"å …å®Ÿã§ç¾å®Ÿçš„/ç©ã¿ä¸Šã’ãŒå¾—æ„",é¢¨:"æƒ…å ±ã¨äº¤æµã§é€²ã‚€/è¨€è‘‰ã®åŠ›",æ°´:"æ„Ÿæƒ…ã¨å…±æ„Ÿ/å¯„ã‚Šæ·»ã„"};
    return `å…¨ä½“ã¯ã€Œ${top}ã€è¦ç´ ãŒå¼·ã‚ã€‚æ¬¡ã«ã€Œ${second}ã€ãŒç¶šãã¾ã™ã€‚${map[top]}å‚¾å‘ã«ã€${map[second]}ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ãŒæ··ã–ã‚Šã¾ã™ã€‚`; }
  function pickMode(){const sorted=Object.entries(mdCount).sort((a,b)=>b[1]-a[1]); const top=sorted[0][0];
    const map={æ´»å‹•:"å§‹ã‚ã‚‹åŠ›ãŒå¼·ãã€æœ€åˆã®ä¸€æ­©ãŒæ—©ã„æ™‚ã€‚",ä¸å‹•:"ç¶™ç¶šã¨å®‰å®šã«å¼·ã¿ã€‚è…°ã‚’æ®ãˆã‚‹ã¨æˆæœãŒå‡ºã¾ã™ã€‚",æŸ”è»Ÿ:"çŠ¶æ³ã«åˆã‚ã›ã¦æŸ”ã‚‰ã‹ãèˆµå–ã‚Šã§ãã‚‹æ™‚ã€‚"}; return map[top];}
  const love=`é‡‘æ˜Ÿã¨ç«æ˜Ÿã®é…ç½®ã‹ã‚‰ã€æ‹æ„›ã¯ã€Œç´ ç›´ã•ã€ã¨ã€Œãƒ†ãƒ³ãƒæ„Ÿã€ã‚’æ•´ãˆã‚‹ã¨é€²ã¿ã‚„ã™ã„æ™‚æœŸã€‚å®‰å¿ƒã§ãã‚‹ä¼šè©±ã‚’é‡ã­ã‚‹ã»ã©å®Ÿã‚ŠãŒã‚ã‚Šã¾ã™ã€‚`;
  const work=`å¤ªé™½ã¨MCã®é–¢ä¿‚ã‹ã‚‰ã€ä»•äº‹ã¯ã€Œè¦‹ã›æ–¹ã€ã¨ã€Œæ®µå–ã‚Šã€ã®ä¸¡ç«‹ãŒéµã€‚æœŸé™ã‚’åŒºåˆ‡ã£ã¦å°ã•ãé”æˆâ†’ç©ã¿ä¸Šã’ã‚‹ã¨è©•ä¾¡ãŒå®‰å®šã—ã¾ã™ã€‚`;
  const future=`ä»Šå¾ŒåŠå¹´ã¯ã€æ—¥å¸¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã®è¦‹ç›´ã—ãŒå¹¸é‹ã®å…¥å£ã€‚è‹¦æ‰‹ã‚’æ¸›ã‚‰ã™ã‚ˆã‚Šã€å¾—æ„ã‚’ä¼¸ã°ã™é…ç½®ã§ã™ã€‚`;
  const move=`å¼•ã£è¶Šã—/è»¢è·æ™‚æœŸã¯ã€æœˆã®ã‚µã‚¤ã‚¯ãƒ«ã«åˆã‚ã›ã¦ç›´è¦³ãŒå†´ãˆã‚‹é ƒãŒå‰ã€‚ã¾ãšâ€œè¦‹ã«è¡Œãâ€ã“ã¨ã§æµã‚ŒãŒç”Ÿã¾ã‚Œã¾ã™ã€‚`;
  const lines=[`ğŸŒå¤ªé™½ï¼š${SIGNS[sunS]}ï¼ğŸŒ™æœˆï¼š${SIGNS[moonS]}ï¼ASCï¼š${degToSignText(asc)}ï¼MCï¼š${degToSignText(mc)}`, pickEnergy(), pickMode(), love, work, future, move,
  `ã¾ã¨ã‚ï¼šå¾—æ„ãªãƒªã‚ºãƒ ã‚’å®ˆã‚Šã¤ã¤ã€è¨€è‘‰ã«ã—ã¦å…±æœ‰ã™ã‚‹ã»ã©é‹ãŒå‘³æ–¹ã—ã¾ã™ã€‚å°ã•ãªæˆåŠŸä½“é¨“ã‚’é‡ã­ã¦ã„ãã¾ã—ã‚‡ã†ã€‚`];
  return lines.map(gentlePara).join("\n");
}

// --- compute/build
function computeAll(meta){
  const [y,mo,da]=meta.date.split('-').map(Number); const [hh,mi]=(meta.time||"00:00").split(':').map(Number);
  const jd=jdFromYMD(y,mo,da, hh-meta.tz-meta.dst, mi);
  const {ASC,MC}=ascMcFrom(jd,meta.lat,meta.lon);
  const pos={ASC,MC};
  ["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"].forEach(n=>pos[n]=LON[n](jd));
  const houses = meta.house==='equal' ? Houses.equal(ASC) : Houses.whole(ASC);
  return {pos,houses,jd};
}
function buildNatal(meta){
  const {pos,houses}=computeAll(meta);
  drawChart(document.getElementById('cv'),pos,houses,{orb:meta.orb});
  setBarsAndPills(pos);
  buildMatrix(document.getElementById('aspMatrix'),pos,meta.orb);
  buildAspectLists(pos, meta.orb);
  document.getElementById("sum_name").textContent = meta.name || "â€”";
  document.getElementById("sum_date").textContent = `${meta.date||""}ã€€${meta.time||""}`;
  document.getElementById("sum_place").textContent = (document.getElementById("place")?.value||"â€”");
  document.getElementById('report').value = aiReading(meta,pos,houses);
}
function buildSyn(){
  const A=readPerson('A'), B=readPerson('B');
  const tz=+val('syn_tz'), dst=+val('syn_dst'), house=val('syn_house'), orb=+val('syn_orb');
  function calc(p){const [y,mo,da]=p.date.split('-').map(Number); const [hh,mi]=(p.time||"00:00").split(':').map(Number);
    const jd=jdFromYMD(y,mo,da, hh-tz-dst, mi); const {ASC,MC}=ascMcFrom(jd,p.lat,p.lon);
    const pos={ASC,MC}; ["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"].forEach(n=>pos[n]=LON[n](jd));
    const houses= house==='equal'?Houses.equal(ASC):Houses.whole(ASC); return {pos,houses};}
  const a=calc(A), b=calc(B);
  const C=document.getElementById('cv_syn'); drawChart(C,a.pos,a.houses,{orb});
  const ctx=C.getContext('2d'), W=C.width, H=C.height, cx=W/2, cy=H/2; const R=Math.min(W,H)*0.46, bandR2=R-92, rPl=bandR2-26;
  Object.keys(b.pos).forEach(k=>{if(k==="ASC"||k==="MC") return; const ang=b.pos[k]*DEG - Math.PI/2; const x=cx+rPl*Math.cos(ang), y=cy+rPl*Math.sin(ang);
    ctx.beginPath(); ctx.arc(x,y,12,0,Math.PI*2); ctx.fillStyle="#0b1423"; ctx.fill(); ctx.lineWidth=2.2; ctx.strokeStyle=getCSS('--mate'); ctx.stroke();
    const gl=PLANETS.find(p=>p[0]===k)[2]; ctx.fillStyle=getCSS('--mate');
    ctx.font="16px 'Times New Roman','Noto Sans Symbols2',serif"; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(gl,x,y);});
  buildSynMatrix(document.getElementById('synMatrix'),a.pos,b.pos,orb);
  document.getElementById('synReport').value =
   `â€¢ äºŒäººã®åŸºèª¿ï¼š${compatTone(a.pos,b.pos)}\nâ€¢ æ‹æ„›ï¼š${compatLove(a.pos,b.pos)}\nâ€¢ ä»•äº‹ï¼š${compatWork(a.pos,b.pos)}\nâ€¢ ã¾ã¨ã‚ï¼š${compatSummary(a.pos,b.pos)}`;
  function getCSS(v){return getComputedStyle(document.body).getPropertyValue(v).trim()}
}

// --- simple synastry heuristics
function compatTone(a,b){const elA=["Sun","Moon","Venus","Mars"].map(k=>elementOf(a[k])); const elB=["Sun","Moon","Venus","Mars"].map(k=>elementOf(b[k])); const same=elA.filter(x=>elB.includes(x)).length; return same>=3 ? "ãƒªã‚ºãƒ ãŒåˆã„ã‚„ã™ãè‡ªç„¶ä½“ã«ãªã‚Œã‚‹é–¢ä¿‚" : "é•ã„ãŒåˆºæ¿€ã«ãªã‚‹é–¢ä¿‚ã€‚ãƒšãƒ¼ã‚¹é…åˆ†ã®å…±æœ‰ãŒéµ";}
function compatLove(a,b){const d=dAng(a.Venus,b.Mars); return Math.abs(d-120)<=8 ? "æƒ¹ã‹ã‚Œåˆã„ã‚„ã™ãæˆé•·ã—åˆãˆã‚‹é…ç½®" : Math.abs(d-90)<=7 ? "æƒ…ç†±çš„ã ãŒãƒ†ãƒ³ãƒè¡çªã€‚åˆå›³ã‚’æ±ºã‚ã‚‹ã¨â—" : "ä¼šè©±é‡ã¨å®‰å¿ƒæ„Ÿã‚’å¢—ã‚„ã™ã¨æ·±ã¾ã‚Šã‚„ã™ã„";}
function compatWork(a,b){const d=dAng(a.Sun,b.Saturn); return Math.abs(d-60)<=6 ? "è²¬ä»»ã¨å½¹å‰²åˆ†æ‹…ãŒæ©Ÿèƒ½ã—ã‚„ã™ã„ç›¸æ€§" : Math.abs(d-180)<=8 ? "æ–¹å‘æ€§ãŒå‰²ã‚Œã‚„ã™ã„ã€‚ç›®æ¨™åˆæ„ã‚’å…ˆã«" : "ãŠäº’ã„ã®å¼·ã¿ã‚’å®šç¾©ã—ã¦å”åŠ›ã™ã‚‹ã¨æˆæœãŒå‡ºã‚‹";}
function compatSummary(a,b){const dm=dAng(a.Moon,b.Moon); return dm<30 ? "ç”Ÿæ´»ãƒªã‚ºãƒ ãŒä¼¼ã¦ã„ã¦å®‰å¿ƒæ„ŸãŒå¼·ã„" : "å¿ƒã®ãƒªã‚ºãƒ ãŒé•ã†åˆ†ã€è¨€èªåŒ–ãŒåŠ©ã‘ã«ãªã‚Šã¾ã™";}

// --- UI
function $(s){return document.querySelector(s)}
document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active');
  const id=t.dataset.tab; document.getElementById('natal').classList.toggle('hide', id!=='natal');
  document.getElementById('syn').classList.toggle('hide', id!=='syn');
});
$("#geo").onclick=async()=>{const q=$("#place").value.trim(); if(!q)return; const g=await geocode(q); if(!g){alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");return} $("#lat").value=g.lat; $("#lon").value=g.lon; alert("ç·¯åº¦çµŒåº¦ã‚’åæ˜ ã—ã¾ã—ãŸ")}
$("#A_geo").onclick=async()=>{const q=$("#A_place").value.trim(); if(!q)return; const g=await geocode(q); if(!g){alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");return} $("#A_lat").value=g.lat; $("#A_lon").value=g.lon; alert("Aã«åæ˜ ã—ã¾ã—ãŸ")}
$("#B_geo").onclick=async()=>{const q=$("#B_place").value.trim(); if(!q)return; const g=await geocode(q); if(!g){alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");return} $("#B_lat").value=g.lat; $("#B_lon").value=g.lon; alert("Bã«åæ˜ ã—ã¾ã—ãŸ")}
$("#calcAsc").onclick=()=>{const m=getMeta(); if(!m.date){alert("ç”Ÿå¹´æœˆæ—¥ã‚’å…¥ã‚Œã¦ãã ã•ã„"); return}
  const [y,mo,da]=m.date.split('-').map(Number); const [hh,mi]=(m.time||"00:00").split(':').map(Number);
  const jd=jdFromYMD(y,mo,da, hh-m.tz-m.dst, mi); const {ASC,MC}=ascMcFrom(jd,m.lat,m.lon);
  alert(`ASC ${degToSignText(ASC)} / MC ${degToSignText(MC)} ã‚’è¨ˆç®—ã—ã¾ã—ãŸï¼ˆé‘‘å®šä½œæˆã§åæ˜ ï¼‰`);
}
function getMeta(){return {name:$("#name").value,date:$("#date").value,time:$("#time").value,tz:+($("#tz").value||0),dst:+($("#dst").value||0),lat:+($("#lat").value||0),lon:+($("#lon").value||0),house:$("#house").value,orb:+($("#orb").value||6)}}
$("#run").onclick=()=>{const m=getMeta(); if(!m.date||isNaN(m.lat)||isNaN(m.lon)){alert("æ—¥ä»˜ã¨ç·¯åº¦çµŒåº¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆåœ°åæ¤œç´¢â†’åæ˜ ï¼‰");return} buildNatal(m)}
$("#syn_run").onclick=()=>{if(!$("#A_date").value||!$("#B_date").value){alert("A/Bä¸¡æ–¹ã®æ—¥ä»˜ã‚’å…¥ã‚Œã¦ãã ã•ã„"); return}
  buildSyn()}

// hidden placeholders (not shown but kept foræ‹¡å¼µ)
const planetTbl=document.createElement('table'); planetTbl.id='planetTbl'; planetTbl.className='table hide'; document.body.appendChild(planetTbl);
const houseTbl=document.createElement('table'); houseTbl.id='houseTbl'; houseTbl.className='table hide'; document.body.appendChild(houseTbl);
</script>
</body>
</html>
